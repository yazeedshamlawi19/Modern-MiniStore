<?php
// ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© (Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŒ BASE_URLØŒ Ø¥Ù„Ø®)
require_once __DIR__ . '/config.php';

// ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
require_once __DIR__ . '/db.php';

// Ø¨Ø¯Ø¡ Ø§Ù„Ø¬Ù„Ø³Ø© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø¯Ù…Ù† Ø§Ù„Ù…Ø®Ø²Ù†Ø©
session_start();

// Ø§Ù„ØªØ­Ù‚Ù‚: Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ø¯Ù…Ù†
// ÙŠØªÙ… ØªØ­ÙˆÙŠÙ„Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø© Ø¥Ù„Ù‰ ØµÙØ­Ø© ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†
if (!is_admin()) {
    header('Location: admin_login.php');
    exit;
}

// Ø¥Ù†Ø´Ø§Ø¡ Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
$pdo = db();

// Ø¬Ù„Ø¨ Ø¢Ø®Ø± 200 Ø·Ù„Ø¨ Ù…Ù† Ø¬Ø¯ÙˆÙ„ orders
// Ù…Ø±ØªØ¨Ø© ØªÙ†Ø§Ø²Ù„ÙŠÙ‹Ø§ (Ø§Ù„Ø£Ø­Ø¯Ø« Ø£ÙˆÙ„Ø§Ù‹)
$orders = $pdo
    ->query("SELECT * FROM orders ORDER BY id DESC LIMIT 200")
    ->fetchAll();

// Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ù†ØµÙˆØµ Ù…Ù† XSS Ø¹Ù†Ø¯ Ø§Ù„Ø¹Ø±Ø¶
function h($s){
    return htmlspecialchars($s ?? '', ENT_QUOTES, 'UTF-8');
}
?>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <!-- ØªØ­Ø¯ÙŠØ¯ ØªØ±Ù…ÙŠØ² Ø§Ù„ØµÙØ­Ø© Ù„Ø¯Ø¹Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© -->
  <meta charset="UTF-8" />

  <!-- Ø¬Ø¹Ù„ Ø§Ù„ØµÙØ­Ø© Ù…ØªØ¬Ø§ÙˆØ¨Ø© Ù…Ø¹ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„Ù…Ø®ØªÙ„ÙØ© -->
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØµÙØ­Ø© ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ -->
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª (Ù…Ø³Ø¤ÙˆÙ„)</title>

  <!-- ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¹Ø§Ù… -->
  <link rel="stylesheet" href="assets/style.css" />
</head>

<body>

<header class="container">
  <!-- Ø¹Ù†ÙˆØ§Ù† ØµÙØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
  <h1>ðŸ“¦ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>

  <nav>
    <!-- Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙ†Ù‚Ù„ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø£Ø¯Ù…Ù† -->
    <a href="index.php">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>
    <a href="cart.php">Ø§Ù„Ø¹Ø±Ø¨Ø©</a>
    <a href="orders.php">Ø§Ù„Ø·Ù„Ø¨Ø§Øª</a>
    <a href="admin_logout.php">Ø®Ø±ÙˆØ¬ (Ù…Ø³Ø¤ÙˆÙ„)</a>
  </nav>
</header>

<main class="container">
  <?php if (!$orders): ?>
    <!-- ÙÙŠ Ø­Ø§Ù„ Ù„Ù… ÙŠÙƒÙ† Ù‡Ù†Ø§Ùƒ Ø£ÙŠ Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
    <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¨Ø¹Ø¯.</p>
  <?php else: ?>
    <!-- ÙÙŠ Ø­Ø§Ù„ ÙˆØ¬ÙˆØ¯ Ø·Ù„Ø¨Ø§Øª -->

    <table class="table">
      <!-- Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
      <thead>
        <tr>
          <th>#</th>
          <!-- Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ -->
          <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
          <!-- ØªØ§Ø±ÙŠØ® Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ -->
          <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
          <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ -->
          <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
          <!-- Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ù„Øº -->
          <th>Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
          <!-- Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ + Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ -->
          <th>Ø·Ø±ÙŠÙ‚Ø©</th>
          <!-- Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… -->
        </tr>
      </thead>

      <tbody>
        <?php foreach ($orders as $o): ?>
          <!-- Ø­Ù„Ù‚Ø© ØªÙ…Ø± Ø¹Ù„Ù‰ ÙƒÙ„ Ø·Ù„Ø¨ -->
          <tr>
            <!-- Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
            <td><?php echo (int)$o['id']; ?></td>

            <!-- ØªØ§Ø±ÙŠØ® Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø·Ù„Ø¨ -->
            <td><?php echo h($o['created_at']); ?></td>

            <!-- Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ -->
            <td><?php echo h($o['status']); ?></td>

            <!-- Ø§Ù„Ù…Ø¨Ù„Øº + Ø§Ù„Ø¹Ù…Ù„Ø© -->
            <td>
              <?php
                echo number_format((float)$o['amount'], 2)
                . ' '
                . h($o['currency']);
              ?>
            </td>

            <!-- Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ + Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ -->
            <td>
              <?php
                echo h($o['customer_name'])
                . ' / '
                . h($o['customer_phone']);
              ?>
            </td>

            <!-- Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… (delivery / pickup) -->
            <td><?php echo h($o['delivery_method']); ?></td>
          </tr>
        <?php endforeach; ?>
      </tbody>
    </table>

  <?php endif; ?>
</main>

</body>
</html>
